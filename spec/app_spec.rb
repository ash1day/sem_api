require File.expand_path '../spec_helper.rb', __FILE__

describe 'App' do
  describe 'Post /sem' do
    before { post '/sem', params, { 'CONTENT_TYPE' => 'application/json', 'ACCEPT' => 'application/json' } }

    context 'nobs, cov' do
      let(:params) {
        {
          nobs: 75,
          obs_names: %w(y1 y2 y3 y4 y5 y6 y7 y8 x1 x2 x3),
          cov: [
            [6.8785658],
            [6.2513659, 15.5798162],
            [5.8388354, 5.8386258, 10.7642473],
            [6.0886427, 9.5085534, 6.687937, 11.218932],
            [5.0638108, 5.6030723, 4.9390271, 5.702059, 6.82569],
            [5.7458262, 9.3862893, 4.7273963, 7.442182, 4.976805, 11.3753251],
            [5.8119432, 7.5354623, 7.0064347, 7.487999, 5.821366, 6.748119, 10.7993719],
            [5.6710576, 7.7582132, 5.6391391, 8.012646, 5.339386, 8.2468297, 7.5924331, 10.533872],
            [0.734393, 0.6194955, 0.7868787, 1.150461, 1.081626, 0.8527889, 0.9368373, 1.102881, 0.5371487],
            [1.2733939, 1.4912729, 1.5519351, 2.240957, 2.063733, 1.8054863, 1.9955952, 2.234237, 0.9903611, 2.282107],
            [0.9114547, 1.1698131, 1.0390796, 1.838023, 1.583465, 1.5720662, 1.6259535, 1.692157, 0.823424, 1.8060906, 1.9760241]
          ],
          model: {
            latent_variable: {
              ind60: ['x1', 'x2', 'x3'],
              dem60: ['y1', 'y2', 'y3', 'y4'],
              dem65: ['y5', 'y6', 'y7', 'y8']
            },
            regression: {
              dem60: ['ind60'],
              dem65: ['ind60', 'dem60']
            },
            covariance: {
              y1: ['y5'],
              y2: ['y4', 'y6'],
              y3: ['y7'],
              y4: ['y8'],
              y6: ['y8']
            }
          }
        }.to_json
      }
      it '正常なレスポンスが返ること' do
        expect(last_response).to be_ok
        expect(last_response.body).to eq "{\"latent_variables\":{\"ind60\":[{\"name\":\"x1\",\"Estimate\":\"1.000\",\"Std.Err\":\"\",\"Z-value\":\"\",\"P(>|z|)\":\"\"},{\"name\":\"x2\",\"Estimate\":\"2.180\",\"Std.Err\":\"0.139\",\"Z-value\":\"15.742\",\"P(>|z|)\":\"0.000\"},{\"name\":\"x3\",\"Estimate\":\"1.819\",\"Std.Err\":\"0.152\",\"Z-value\":\"11.967\",\"P(>|z|)\":\"0.000\"}],\"dem60\":[{\"name\":\"y1\",\"Estimate\":\"1.000\",\"Std.Err\":\"\",\"Z-value\":\"\",\"P(>|z|)\":\"\"},{\"name\":\"y2\",\"Estimate\":\"1.257\",\"Std.Err\":\"0.182\",\"Z-value\":\"6.889\",\"P(>|z|)\":\"0.000\"},{\"name\":\"y3\",\"Estimate\":\"1.058\",\"Std.Err\":\"0.151\",\"Z-value\":\"6.987\",\"P(>|z|)\":\"0.000\"},{\"name\":\"y4\",\"Estimate\":\"1.265\",\"Std.Err\":\"0.145\",\"Z-value\":\"8.722\",\"P(>|z|)\":\"0.000\"}],\"dem65\":[{\"name\":\"y5\",\"Estimate\":\"1.000\",\"Std.Err\":\"\",\"Z-value\":\"\",\"P(>|z|)\":\"\"},{\"name\":\"y6\",\"Estimate\":\"1.186\",\"Std.Err\":\"0.169\",\"Z-value\":\"7.024\",\"P(>|z|)\":\"0.000\"},{\"name\":\"y7\",\"Estimate\":\"1.280\",\"Std.Err\":\"0.160\",\"Z-value\":\"8.002\",\"P(>|z|)\":\"0.000\"},{\"name\":\"y8\",\"Estimate\":\"1.266\",\"Std.Err\":\"0.158\",\"Z-value\":\"8.007\",\"P(>|z|)\":\"0.000\"}]},\"regressions\":{\"dem60\":[{\"name\":\"ind60\",\"Estimate\":\"1.483\",\"Std.Err\":\"0.399\",\"Z-value\":\"3.715\",\"P(>|z|)\":\"0.000\"}],\"dem65\":[{\"name\":\"ind60\",\"Estimate\":\"0.572\",\"Std.Err\":\"0.221\",\"Z-value\":\"2.586\",\"P(>|z|)\":\"0.010\"},{\"name\":\"dem60\",\"Estimate\":\"0.837\",\"Std.Err\":\"0.098\",\"Z-value\":\"8.514\",\"P(>|z|)\":\"0.000\"}]},\"covariances\":{\"y1\":[{\"name\":\"y5\",\"Estimate\":\"0.624\",\"Std.Err\":\"0.358\",\"Z-value\":\"1.741\",\"P(>|z|)\":\"0.082\"}],\"y2\":[{\"name\":\"y4\",\"Estimate\":\"1.313\",\"Std.Err\":\"0.702\",\"Z-value\":\"1.871\",\"P(>|z|)\":\"0.061\"},{\"name\":\"y6\",\"Estimate\":\"2.153\",\"Std.Err\":\"0.734\",\"Z-value\":\"2.934\",\"P(>|z|)\":\"0.003\"}],\"y3\":[{\"name\":\"y7\",\"Estimate\":\"0.795\",\"Std.Err\":\"0.608\",\"Z-value\":\"1.308\",\"P(>|z|)\":\"0.191\"}],\"y4\":[{\"name\":\"y8\",\"Estimate\":\"0.348\",\"Std.Err\":\"0.442\",\"Z-value\":\"0.787\",\"P(>|z|)\":\"0.431\"}],\"y6\":[{\"name\":\"y8\",\"Estimate\":\"1.356\",\"Std.Err\":\"0.568\",\"Z-value\":\"2.386\",\"P(>|z|)\":\"0.017\"}]},\"variances\":{\"x1\":{\"Estimate\":\"0.082\",\"Std.Err\":\"0.019\",\"Z-value\":\"4.184\",\"P(>|z|)\":\"0.000\"},\"x2\":{\"Estimate\":\"0.120\",\"Std.Err\":\"0.070\",\"Z-value\":\"1.718\",\"P(>|z|)\":\"0.086\"},\"x3\":{\"Estimate\":\"0.467\",\"Std.Err\":\"0.090\",\"Z-value\":\"5.177\",\"P(>|z|)\":\"0.000\"},\"y1\":{\"Estimate\":\"1.891\",\"Std.Err\":\"0.444\",\"Z-value\":\"4.256\",\"P(>|z|)\":\"0.000\"},\"y2\":{\"Estimate\":\"7.373\",\"Std.Err\":\"1.374\",\"Z-value\":\"5.366\",\"P(>|z|)\":\"0.000\"},\"y3\":{\"Estimate\":\"5.067\",\"Std.Err\":\"0.952\",\"Z-value\":\"5.324\",\"P(>|z|)\":\"0.000\"},\"y4\":{\"Estimate\":\"3.148\",\"Std.Err\":\"0.739\",\"Z-value\":\"4.261\",\"P(>|z|)\":\"0.000\"},\"y5\":{\"Estimate\":\"2.351\",\"Std.Err\":\"0.480\",\"Z-value\":\"4.895\",\"P(>|z|)\":\"0.000\"},\"y6\":{\"Estimate\":\"4.954\",\"Std.Err\":\"0.914\",\"Z-value\":\"5.419\",\"P(>|z|)\":\"0.000\"},\"y7\":{\"Estimate\":\"3.431\",\"Std.Err\":\"0.713\",\"Z-value\":\"4.814\",\"P(>|z|)\":\"0.000\"},\"y8\":{\"Estimate\":\"3.254\",\"Std.Err\":\"0.695\",\"Z-value\":\"4.685\",\"P(>|z|)\":\"0.000\"},\"ind60\":{\"Estimate\":\"0.448\",\"Std.Err\":\"0.087\",\"Z-value\":\"5.173\",\"P(>|z|)\":\"0.000\"},\"dem60\":{\"Estimate\":\"3.956\",\"Std.Err\":\"0.921\",\"Z-value\":\"4.295\",\"P(>|z|)\":\"0.000\"},\"dem65\":{\"Estimate\":\"0.172\",\"Std.Err\":\"0.215\",\"Z-value\":\"0.803\",\"P(>|z|)\":\"0.422\"}},\"goodness_of_fit\":{\"npar\":\"31.000\",\"fmin\":\"0.254\",\"chisq\":\"38.125\",\"df\":\"35.000\",\"pvalue\":\"0.329\",\"baseline.chisq\":\"730.654\",\"baseline.df\":\"55.000\",\"baseline.pvalue\":\"0.000\",\"cfi\":\"0.995\",\"tli\":\"0.993\",\"nnfi\":\"0.993\",\"rfi\":\"0.918\",\"nfi\":\"0.948\",\"pnfi\":\"0.603\",\"ifi\":\"0.996\",\"rni\":\"0.995\",\"logl\":\"-1547.791\",\"unrestricted.logl\":\"-1528.728\",\"aic\":\"3157.582\",\"bic\":\"3229.424\",\"ntotal\":\"75.000\",\"bic2\":\"3131.720\",\"rmsea\":\"0.035\",\"rmsea.ci.lower\":\"0.000\",\"rmsea.ci.upper\":\"0.092\",\"rmsea.pvalue\":\"0.611\",\"rmr\":\"0.276\",\"rmr_nomean\":\"0.276\",\"srmr\":\"0.044\",\"srmr_bentler\":\"0.044\",\"srmr_bentler_nomean\":\"0.044\",\"srmr_bollen\":\"0.045\",\"srmr_bollen_nomean\":\"0.045\",\"srmr_mplus\":\"0.045\",\"srmr_mplus_nomean\":\"0.045\",\"cn_05\":\"98.970\",\"cn_01\":\"113.803\",\"gfi\":\"0.923\",\"agfi\":\"0.854\",\"pgfi\":\"0.489\",\"mfi\":\"0.979\",\"ecvi\":\"1.335\"},\"names\":[\"dem60\",\"dem65\",\"ind60\",\"x1\",\"x2\",\"x3\",\"y1\",\"y2\",\"y3\",\"y4\",\"y5\",\"y6\",\"y7\",\"y8\"],\"total_effects\":[[0.0,-1.1102230246251565e-16,1.4829999999999999,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.8370000000000001,0.0,1.813271,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,2.18,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[3.3306690738754696e-16,0.0,1.8190000000000002,0.0,0.0,0.0,0.0,0.0,0.0,1.1102230246251565e-16,0.0,0.0,0.0,0.0],[1.0,-1.1102230246251565e-16,1.4829999999999999,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[1.257,-2.220446049250313e-16,1.864131,0.0,0.0,0.0,0.0,0.0,0.0,1.1102230246251565e-16,0.0,0.0,0.0,0.0],[1.0579999999999998,-1.1102230246251565e-16,1.569014,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[1.265,0.0,1.8759949999999999,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.8370000000000001,1.0,1.813271,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.9926820000000001,1.186,2.150539406,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[1.0713600000000003,1.2800000000000002,2.3209868800000004,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[1.059642,1.266,2.295601086,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]]}"
      end
    end

    context 'data' do
      let(:data) do
        {
          y1: [2.5, 1.25, 7.5, 8.9, 10.0, 7.5, 7.5, 7.5, 2.5, 10.0, 7.5, 7.5, 7.5, 7.5, 7.5, 7.5, 2.5, 1.25, 10.0, 7.5, 10.0, 1.25, 2.5, 7.5, 8.5, 6.1, 3.3, 2.9, 9.2, 6.9, 2.9, 2.0, 5.0, 5.0, 4.1, 6.3, 5.2, 5.0, 3.1, 4.1, 5.0, 5.0, 5.0, 5.6, 5.7, 7.5, 2.5, 8.9, 7.6, 7.8, 2.5, 3.8, 5.0, 6.25, 1.25, 1.25, 1.25, 7.5, 2.5, 7.5, 1.25, 1.25, 2.5, 6.25, 7.5, 5.0, 7.5, 4.9, 5.0, 2.9, 5.4, 7.5, 7.5, 10.0, 3.75],
          y2: [0.0, 0.0, 8.8, 8.8, 3.333333, 3.333333, 3.333333, 2.233333, 3.333333, 6.666666, 3.333333, 3.333333, 3.333333, 7.766664, 9.999998, 9.999998, 3.333333, 0.0, 9.999998, 3.333299, 9.999998, 0.0, 0.0, 6.666666, 9.999998, 0.0, 0.0, 3.333333, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.999998, 9.999998, 4.999998, 3.333333, 4.999998, 9.999998, 9.999998, 7.7, 6.2, 4.9, 4.8, 9.999998, 0.0, 9.999998, 0.0, 9.999998, 0.0, 0.0, 3.333333, 3.333333, 0.0, 0.0, 0.0, 7.766664, 0.0, 9.999998, 0.0, 0.0, 0.0, 2.233299, 9.999998, 0.0, 9.999998, 2.233333, 0.0, 3.333333, 9.999998, 8.8, 7.0, 6.666666, 3.333333],
          y3: [3.333333, 3.333333, 9.999998, 9.999998, 9.999998, 6.666666, 6.666666, 9.999998, 3.333333, 9.999998, 9.999998, 6.666666, 9.999998, 9.999998, 3.333333, 9.999998, 6.666666, 3.333333, 9.999998, 3.333333, 9.999998, 0.0, 3.333333, 9.999998, 6.666666, 5.4, 6.666666, 6.666666, 9.9, 6.666666, 3.333333, 0.0, 3.333333, 9.999998, 4.7, 9.999998, 6.6, 6.4, 4.2, 6.666666, 6.666666, 6.666666, 9.999998, 0.0, 0.0, 7.9, 6.666666, 9.7, 10.0, 6.666666, 6.666666, 5.1, 3.333333, 9.999998, 3.333333, 4.7, 6.666666, 9.999998, 6.666666, 9.999998, 0.0, 0.0, 0.0, 6.666666, 9.999998, 6.1, 9.999998, 9.999998, 8.2, 6.666666, 6.666666, 9.999998, 9.999998, 9.999998, 0.0],
          y4: [0.0, 0.0, 9.199991, 9.199991, 6.666666, 6.666666, 6.666666, 1.496333, 3.333333, 8.899991, 6.666666, 6.666666, 6.666666, 6.666666, 10.0, 7.766666, 6.666666, 3.333333, 10.0, 6.666666, 10.0, 0.0, 3.333333, 10.0, 6.666666, 3.333333, 3.333333, 3.333333, 3.333333, 3.333333, 3.333333, 0.0, 3.333333, 3.333333, 6.666666, 6.666666, 3.333333, 6.666666, 5.0, 3.333333, 1.666666, 8.399997, 6.060997, 0.0, 0.0, 6.666666, 3.333333, 6.666666, 0.0, 6.666666, 3.333333, 0.0, 2.233333, 2.955702, 0.0, 0.736999, 0.0, 6.666666, 4.433333, 10.0, 0.0, 0.0, 0.0, 2.970332, 10.0, 0.0, 10.0, 0.0, 0.0, 3.333333, 3.333333, 6.066666, 6.852998, 10.0, 0.0],
          y5: [1.25, 6.25, 8.75, 8.907948, 7.5, 6.25, 5.0, 6.25, 6.25, 8.75, 8.75, 8.75, 7.5, 7.5, 7.5, 7.5, 5.0, 1.25, 8.75, 7.5, 10.0, 2.5, 2.5, 7.5, 8.75, 0.0, 6.25, 2.385559, 7.60966, 4.226033, 5.0, 0.0, 5.0, 0.0, 3.75, 6.25, 3.633403, 2.844997, 3.75, 5.0, 5.0, 6.25, 5.0, 6.555647, 6.555647, 3.75, 2.5, 5.0, 5.0, 5.0, 5.0, 3.75, 5.0, 6.25, 2.5, 2.5, 2.5, 7.5, 5.0, 8.75, 1.25, 0.0, 0.0, 3.75, 7.5, 5.0, 3.75, 5.0, 5.0, 2.5, 3.75, 7.5, 7.5, 10.0, 1.25],
          y6:   [0.0, 1.1, 8.094061, 8.127979, 3.333333, 1.1, 2.233333, 3.333333, 3.333333, 6.666666, 3.333333, 3.333333, 3.333333, 0.0, 6.666666, 1.1, 1.1, 3.333333, 9.999998, 2.233299, 9.999998, 0.0, 0.0, 6.666666, 9.999998, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.233333, 1.1, 0.0, 0.0, 0.0, 0.0, 4.358243, 2.782771, 4.055463, 4.055463, 9.999998, 0.0, 9.999998, 1.1, 3.333333, 0.0, 0.0, 3.333333, 5.566663, 0.0, 0.0, 0.0, 3.333333, 0.0, 9.999998, 0.0, 0.0, 0.0, 3.333299, 9.999998, 3.333333, 9.999998, 0.0, 0.0, 3.333333, 6.666666, 6.666666, 6.34834, 6.666666, 3.333333],
          y7: [3.72636, 6.666666, 9.999998, 9.999998, 9.999998, 6.666666, 8.271257, 9.999998, 3.333333, 9.999998, 9.999998, 6.666666, 6.666666, 9.999998, 9.999998, 6.666666, 6.666666, 3.333333, 9.999998, 6.666666, 9.999998, 0.0, 3.333333, 9.999998, 7.351018, 4.696028, 6.666666, 3.177568, 8.118828, 0.0, 3.333333, 0.0, 3.333333, 3.333333, 7.827667, 6.666666, 3.314128, 4.429657, 6.164304, 4.938089, 6.666666, 9.999998, 6.666666, 6.666666, 0.0, 7.631891, 0.0, 9.556024, 6.666666, 6.666666, 6.666666, 6.666666, 6.666666, 9.999998, 0.0, 3.333333, 5.228375, 9.999998, 6.666666, 9.999998, 0.0, 0.0, 6.666666, 6.666666, 9.999998, 9.999998, 9.999998, 3.621989, 0.0, 6.666666, 6.666666, 9.999998, 6.666666, 9.999998, 0.0],
          y8: [3.333333, 0.736999, 8.211809, 4.615086, 6.666666, 0.3685, 1.485166, 6.666666, 3.333333, 10.0, 6.666666, 6.666666, 10.0, 0.0, 10.0, 6.666666, 0.3685, 3.333333, 10.0, 2.948164, 10.0, 0.0, 3.333333, 7.766666, 6.666666, 3.333333, 3.333333, 1.116666, 3.333333, 0.0, 3.333333, 0.0, 3.333333, 0.74437, 6.666666, 2.955702, 3.333333, 1.485166, 3.333333, 2.233333, 0.3685, 4.141377, 4.974739, 3.821796, 0.0, 6.666666, 0.0, 6.666666, 1.099999, 6.666666, 3.333333, 1.485166, 5.566663, 6.666666, 0.0, 3.333333, 0.0, 6.666666, 1.485166, 10.0, 0.0, 0.0, 2.948164, 3.333333, 10.0, 3.333333, 10.0, 3.333333, 0.0, 3.333333, 1.485166, 6.666666, 7.508044, 10.0, 0.0],
          x1: [4.442651, 5.384495, 5.961005, 6.285998, 5.863631, 5.533389, 5.308268, 5.347108, 5.521461, 5.828946, 5.916202, 5.398163, 6.622736, 5.204007, 5.509388, 5.26269, 4.70048, 5.209486, 5.916202, 6.523562, 6.238325, 5.976351, 5.631212, 6.033086, 6.196444, 4.248495, 5.141664, 4.174387, 4.382027, 4.290459, 4.934474, 3.850148, 5.181784, 5.062595, 4.691348, 4.248495, 5.56452, 4.727388, 4.143135, 4.317488, 5.141664, 4.488636, 4.615121, 3.850148, 3.970292, 3.78419, 3.806662, 4.532599, 5.117994, 5.049856, 5.393628, 4.477337, 5.257495, 5.379897, 5.298317, 4.859812, 4.969813, 6.011267, 5.075174, 6.736967, 5.225747, 4.025352, 4.234107, 4.644391, 4.418841, 4.26268, 4.875197, 4.189655, 4.521789, 4.65396, 4.477337, 5.337538, 6.12905, 5.003946, 4.488636],
          x2: [3.637586, 5.062595, 6.25575, 7.567863, 6.818924, 5.135798, 5.075174, 4.85203, 5.241747, 5.370638, 6.423247, 6.246107, 7.872074, 5.225747, 6.202536, 5.820083, 5.023881, 4.465908, 6.732211, 6.992096, 6.746412, 6.712956, 5.937536, 6.09357, 6.704414, 2.70805, 4.564348, 3.688879, 2.890372, 1.609438, 4.234107, 1.94591, 4.394449, 4.59512, 4.143135, 3.367296, 5.236442, 3.610918, 2.302585, 4.955827, 4.430817, 3.465736, 4.941642, 2.397895, 2.397895, 3.091042, 2.079442, 3.610918, 4.934474, 5.111988, 5.638355, 3.931826, 5.840642, 5.505332, 6.274762, 5.669881, 5.56452, 6.253829, 5.252273, 7.125283, 5.451038, 1.791759, 2.70805, 5.56452, 4.941642, 4.219508, 4.70048, 1.386294, 4.127134, 3.555348, 3.091042, 5.631212, 6.403574, 4.962845, 4.89784],
          x3: [2.557615, 3.568079, 5.224433, 6.267495, 4.573679, 3.89227, 3.316213, 4.263183, 4.115168, 4.446216, 3.791545, 4.535708, 4.906154, 4.561047, 4.586286, 3.948911, 4.394491, 4.510268, 5.829084, 6.424591, 5.741711, 5.948168, 5.686755, 4.611429, 5.475261, 1.74083, 2.255134, 3.046927, 1.711279, 1.001674, 1.418971, 2.345229, 3.167167, 3.83497, 2.255134, 3.217506, 2.677633, 1.418971, 1.418971, 4.249888, 3.046927, 2.013579, 2.255134, 1.74083, 1.050741, 2.113313, 2.137561, 1.587802, 3.83497, 4.38149, 4.169451, 2.474671, 5.001796, 3.299937, 4.38149, 3.537416, 4.510268, 5.001796, 5.350708, 6.330518, 3.167167, 2.657972, 2.474671, 3.046927, 3.380653, 4.368462, 3.83497, 1.418971, 2.113313, 1.881917, 1.987909, 3.491004, 5.001796, 3.976994, 2.867566]
        }
      end

      let(:params) {
        {
          data: data,
          model: {
            latent_variable: {
              ind60: ['x1', 'x2', 'x3'],
              dem60: ['y1', 'y2', 'y3', 'y4'],
              dem65: ['y5', 'y6', 'y7', 'y8']
            },
            regression: {
              dem60: ['ind60'],
              dem65: ['ind60', 'dem60']
            },
            covariance: {
              y1: ['y5'],
              y2: ['y4', 'y6'],
              y3: ['y7'],
              y4: ['y8'],
              y6: ['y8']
            }
          }
        }.to_json
      }
      it '正常なレスポンスが返ること' do
        expect(last_response).to be_ok
        expect(last_response.body).to eq "{\"latent_variables\":{\"ind60\":[{\"name\":\"x1\",\"Estimate\":\"1.000\",\"Std.Err\":\"\",\"Z-value\":\"\",\"P(>|z|)\":\"\"},{\"name\":\"x2\",\"Estimate\":\"2.180\",\"Std.Err\":\"0.848\",\"Z-value\":\"2.571\",\"P(>|z|)\":\"0.010\"},{\"name\":\"x3\",\"Estimate\":\"1.819\",\"Std.Err\":\"0.931\",\"Z-value\":\"1.954\",\"P(>|z|)\":\"0.051\"}],\"dem60\":[{\"name\":\"y1\",\"Estimate\":\"1.000\",\"Std.Err\":\"\",\"Z-value\":\"\",\"P(>|z|)\":\"\"},{\"name\":\"y2\",\"Estimate\":\"1.257\",\"Std.Err\":\"1.117\",\"Z-value\":\"1.125\",\"P(>|z|)\":\"0.261\"},{\"name\":\"y3\",\"Estimate\":\"1.058\",\"Std.Err\":\"0.927\",\"Z-value\":\"1.141\",\"P(>|z|)\":\"0.254\"},{\"name\":\"y4\",\"Estimate\":\"1.265\",\"Std.Err\":\"0.888\",\"Z-value\":\"1.424\",\"P(>|z|)\":\"0.154\"}],\"dem65\":[{\"name\":\"y5\",\"Estimate\":\"1.000\",\"Std.Err\":\"\",\"Z-value\":\"\",\"P(>|z|)\":\"\"},{\"name\":\"y6\",\"Estimate\":\"1.186\",\"Std.Err\":\"1.034\",\"Z-value\":\"1.147\",\"P(>|z|)\":\"0.251\"},{\"name\":\"y7\",\"Estimate\":\"1.280\",\"Std.Err\":\"0.979\",\"Z-value\":\"1.307\",\"P(>|z|)\":\"0.191\"},{\"name\":\"y8\",\"Estimate\":\"1.266\",\"Std.Err\":\"0.968\",\"Z-value\":\"1.307\",\"P(>|z|)\":\"0.191\"}]},\"regressions\":{\"dem60\":[{\"name\":\"ind60\",\"Estimate\":\"1.483\",\"Std.Err\":\"2.444\",\"Z-value\":\"0.607\",\"P(>|z|)\":\"0.544\"}],\"dem65\":[{\"name\":\"ind60\",\"Estimate\":\"0.572\",\"Std.Err\":\"1.355\",\"Z-value\":\"0.422\",\"P(>|z|)\":\"0.673\"},{\"name\":\"dem60\",\"Estimate\":\"0.837\",\"Std.Err\":\"0.602\",\"Z-value\":\"1.390\",\"P(>|z|)\":\"0.164\"}]},\"covariances\":{\"y1\":[{\"name\":\"y5\",\"Estimate\":\"0.316\",\"Std.Err\":\"1.112\",\"Z-value\":\"0.284\",\"P(>|z|)\":\"0.776\"}],\"y2\":[{\"name\":\"y4\",\"Estimate\":\"0.665\",\"Std.Err\":\"2.178\",\"Z-value\":\"0.305\",\"P(>|z|)\":\"0.760\"},{\"name\":\"y6\",\"Estimate\":\"1.091\",\"Std.Err\":\"2.277\",\"Z-value\":\"0.479\",\"P(>|z|)\":\"0.632\"}],\"y3\":[{\"name\":\"y7\",\"Estimate\":\"0.403\",\"Std.Err\":\"1.886\",\"Z-value\":\"0.214\",\"P(>|z|)\":\"0.831\"}],\"y4\":[{\"name\":\"y8\",\"Estimate\":\"0.176\",\"Std.Err\":\"1.372\",\"Z-value\":\"0.129\",\"P(>|z|)\":\"0.898\"}],\"y6\":[{\"name\":\"y8\",\"Estimate\":\"0.687\",\"Std.Err\":\"1.764\",\"Z-value\":\"0.390\",\"P(>|z|)\":\"0.697\"}]},\"variances\":{\"x1\":{\"Estimate\":\"0.041\",\"Std.Err\":\"0.060\",\"Z-value\":\"0.683\",\"P(>|z|)\":\"0.494\"},\"x2\":{\"Estimate\":\"0.061\",\"Std.Err\":\"0.216\",\"Z-value\":\"0.281\",\"P(>|z|)\":\"0.779\"},\"x3\":{\"Estimate\":\"0.237\",\"Std.Err\":\"0.280\",\"Z-value\":\"0.845\",\"P(>|z|)\":\"0.398\"},\"y1\":{\"Estimate\":\"0.958\",\"Std.Err\":\"1.379\",\"Z-value\":\"0.695\",\"P(>|z|)\":\"0.487\"},\"y2\":{\"Estimate\":\"3.736\",\"Std.Err\":\"4.263\",\"Z-value\":\"0.876\",\"P(>|z|)\":\"0.381\"},\"y3\":{\"Estimate\":\"2.568\",\"Std.Err\":\"2.953\",\"Z-value\":\"0.869\",\"P(>|z|)\":\"0.385\"},\"y4\":{\"Estimate\":\"1.595\",\"Std.Err\":\"2.293\",\"Z-value\":\"0.696\",\"P(>|z|)\":\"0.487\"},\"y5\":{\"Estimate\":\"1.191\",\"Std.Err\":\"1.490\",\"Z-value\":\"0.799\",\"P(>|z|)\":\"0.424\"},\"y6\":{\"Estimate\":\"2.510\",\"Std.Err\":\"2.837\",\"Z-value\":\"0.885\",\"P(>|z|)\":\"0.376\"},\"y7\":{\"Estimate\":\"1.739\",\"Std.Err\":\"2.212\",\"Z-value\":\"0.786\",\"P(>|z|)\":\"0.432\"},\"y8\":{\"Estimate\":\"1.649\",\"Std.Err\":\"2.156\",\"Z-value\":\"0.765\",\"P(>|z|)\":\"0.444\"},\"ind60\":{\"Estimate\":\"0.227\",\"Std.Err\":\"0.269\",\"Z-value\":\"0.845\",\"P(>|z|)\":\"0.398\"},\"dem60\":{\"Estimate\":\"2.005\",\"Std.Err\":\"2.859\",\"Z-value\":\"0.701\",\"P(>|z|)\":\"0.483\"},\"dem65\":{\"Estimate\":\"0.087\",\"Std.Err\":\"0.667\",\"Z-value\":\"0.131\",\"P(>|z|)\":\"0.896\"}},\"goodness_of_fit\":{\"npar\":\"31.000\",\"fmin\":\"0.254\",\"chisq\":\"1.017\",\"df\":\"35.000\",\"pvalue\":\"1.000\",\"baseline.chisq\":\"19.484\",\"baseline.df\":\"55.000\",\"baseline.pvalue\":\"1.000\",\"cfi\":\"1.000\",\"tli\":\"-0.504\",\"nnfi\":\"-0.504\",\"rfi\":\"0.918\",\"nfi\":\"0.948\",\"pnfi\":\"0.603\",\"ifi\":\"1.000\",\"rni\":\"1.000\",\"logl\":\"-33.797\",\"unrestricted.logl\":\"-33.289\",\"aic\":\"129.595\",\"bic\":\"89.082\",\"ntotal\":\"2.000\",\"bic2\":\"12.050\",\"rmsea\":\"0.000\",\"rmsea.ci.lower\":\"0.000\",\"rmsea.ci.upper\":\"0.000\",\"rmsea.pvalue\":\"1.000\",\"rmr\":\"0.140\",\"rmr_nomean\":\"0.140\",\"srmr\":\"0.044\",\"srmr_bentler\":\"0.044\",\"srmr_bentler_nomean\":\"0.044\",\"srmr_bollen\":\"0.045\",\"srmr_bollen_nomean\":\"0.045\",\"srmr_mplus\":\"0.045\",\"srmr_mplus_nomean\":\"0.045\",\"cn_05\":\"98.970\",\"cn_01\":\"113.803\",\"gfi\":\"0.923\",\"agfi\":\"0.854\",\"pgfi\":\"0.489\",\"mfi\":\"4894.326\",\"ecvi\":\"31.508\"},\"names\":[\"dem60\",\"dem65\",\"ind60\",\"x1\",\"x2\",\"x3\",\"y1\",\"y2\",\"y3\",\"y4\",\"y5\",\"y6\",\"y7\",\"y8\"],\"total_effects\":[[0.0,-1.1102230246251565e-16,1.4829999999999999,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.8370000000000001,0.0,1.813271,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,2.18,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[3.3306690738754696e-16,0.0,1.8190000000000002,0.0,0.0,0.0,0.0,0.0,0.0,1.1102230246251565e-16,0.0,0.0,0.0,0.0],[1.0,-1.1102230246251565e-16,1.4829999999999999,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[1.257,-2.220446049250313e-16,1.864131,0.0,0.0,0.0,0.0,0.0,0.0,1.1102230246251565e-16,0.0,0.0,0.0,0.0],[1.0579999999999998,-1.1102230246251565e-16,1.569014,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[1.265,0.0,1.8759949999999999,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.8370000000000001,1.0,1.813271,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.9926820000000001,1.186,2.150539406,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[1.0713600000000003,1.2800000000000002,2.3209868800000004,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[1.059642,1.266,2.295601086,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]]}"
      end
    end
  end
end

